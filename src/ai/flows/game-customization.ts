// This is an autogenerated file from Firebase Studio.
'use server';

/**
 * @fileOverview A flow to adjust the difficulty level of a game based on vocabulary level.
 *
 * - customizeGameDifficulty - A function that handles the game difficulty customization process.
 * - CustomizeGameDifficultyInput - The input type for the customizeGameDifficulty function.
 * - CustomizeGameDifficultyOutput - The return type for the customizeGameDifficulty function.
 */

import {ai} from '@/ai/genkit';
import {z} from 'genkit';

const CustomizeGameDifficultyInputSchema = z.object({
  documentText: z.string().describe('The text content of the uploaded document.'),
  gameType: z.string().describe('The type of game to customize (e.g., Wordscapes, Drops).'),
  desiredDifficulty: z
    .enum(['easy', 'medium', 'hard'])
    .describe('The desired difficulty level for the game.'),
});
export type CustomizeGameDifficultyInput = z.infer<
  typeof CustomizeGameDifficultyInputSchema
>;

const GameRoundSchema = z.object({
  word: z.string().describe('The correct word for the round.'),
  scrambled: z.string().describe('The scrambled/jumbled version of the word to show the user.'),
  displayPrompt: z.string().describe('The prompt to show the user for this round (e.g., "Unscramble the word").')
});

const CustomizeGameDifficultyOutputSchema = z.object({
  gameTitle: z.string().describe('The title for this specific game session.'),
  rounds: z.array(GameRoundSchema).describe('An array of game rounds, each with a word and a corresponding scrambled version or other data.'),
});
export type CustomizeGameDifficultyOutput = z.infer<
  typeof CustomizeGameDifficultyOutputSchema
>;

export async function customizeGameDifficulty(
  input: CustomizeGameDifficultyInput
): Promise<CustomizeGameDifficultyOutput> {
  return customizeGameDifficultyFlow(input);
}

const prompt = ai.definePrompt({
  name: 'customizeGameDifficultyPrompt',
  input: {schema: CustomizeGameDifficultyInputSchema},
  output: {schema: CustomizeGameDifficultyOutputSchema},
  prompt: `You are a game customization expert. A user has uploaded a document and wants to play a game based on its vocabulary.

Document Text: {{{documentText}}}
Game Type: {{{gameType}}}
Desired Difficulty: {{{desiredDifficulty}}}

1.  Analyze the document text to extract a list of 10 key vocabulary words suitable for the desired difficulty.
2.  Based on the game type, prepare the data for each word.
    *   If the game is 'Wordscapes', 'Word Cookies', or 'Spelling Bee (NYT)', the core mechanic is unscrambling letters. For each word, create a 'scrambled' version of it by jumbling the letters. The display prompt should be "Unscramble the letters to find the word."
    *   For other games like 'Drops' or 'Elevate', which are more complex, for now, also use the unscramble mechanic as a fallback. Create a 'scrambled' version of the word and use the prompt "Unscramble the letters to find the word."
3.  Generate a creative and relevant title for this game session.
4.  Return the title and an array of 10 game rounds.`,
});

const customizeGameDifficultyFlow = ai.defineFlow(
  {
    name: 'customizeGameDifficultyFlow',
    inputSchema: CustomizeGameDifficultyInputSchema,
    outputSchema: CustomizeGameDifficultyOutputSchema,
  },
  async input => {
    const {output} = await prompt(input);
    return output!;
  }
);
